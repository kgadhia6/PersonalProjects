#Imports
import math
import matplotlib.pyplot as plt
import numpy as np

#Variables
planets = []
dt = 0.05
G = 6.6743 * 10**(-11) #Convert to Coulombs constant and treat mass as charge if you want to describe electrostatic interactions

#Classes
class body:
    def __init__(self, mass, pos, v0):
        self.m = mass
        self.x, self.y = pos
        self.vx, self.vy = v0
    
    def __str__(self):
        return f'body: mass = {self.m}; position = {self.position()}; velocity = {self.velocity()}'
    
    def position(self) -> tuple:
        return (self.x, self.y)
    
    def velocity(self) -> tuple:
        return (self.vx, self.vy)
    
    def UpdatePosition(self):
        self.x += self.vx
        self.y += self.vy

#Functions
def hypot(p1: tuple, p2: tuple) -> float:
    x1, y1 = p1
    x2, y2 = p2
    return math.sqrt( (x1 - x2)**2 + (y1 - y2)**2 )

def CalcdV(origin: body, attractors: iter) -> tuple:
    #Calculate total force vector
    Fx, Fy = 0, 0
    for attractor in attractors:
        if not attractor == origin:
            mag = G * origin.m * attractor.m / hypot(origin.position(), attractor.position())**2
            dx, dy = attractor.x - origin.x, attractor.y - origin.y
            theta = math.atan2(dy, dx)
            dFx, dFy = mag * math.cos(theta), mag * math.sin(theta)
            Fx += dFx
            Fy += dFy
    #Convert force vector to acceleration via rearrangement of F=ma
    ax, ay = Fx / origin.m, Fy / origin.m
    #And then convert acceleration vector to dv vector via rearrangement of a = dv/dt
    dvx, dvy = ax * dt, ay * dt
    #And then return our dv vector
    return (dvx, dvy)

#Initialize planets
p1 = body(10, (-5, 5), (0,20))
p2 = body(10, (5, -5), (0,0))
planets.append(p1)
planets.append(p2)

#Now we get on with the show
tset = np.arange(0, .10, dt) #Set up t

#Now we set up the logging array
perplan = [[[], []]]
positions = perplan * len(planets)
for i in range(len(planets)):
    perplanet = perplan.copy()
    positions.append(perplanet)
    
for ti, t in enumerate(tset):
    #First up, logging the positions of all the planets
    for index, attractor in enumerate(planets):
        print(index)
        positions[index][0].append(attractor.x)
        positions[index][1].append(attractor.y)
        #Then we move onto velocity
        v = CalcdV(attractor, planets)
        attractor.vx += v[0]
        attractor.vy += v[1]
    #Then we finally update position
    for attractor in planets:
        attractor.UpdatePosition()

for index, attractor in enumerate(planets):
    plt.plot(positions[index][0], positions[index][1])
    plt.show()
#plt.show()
#    plt.scatter(positions[index][0][0], positions[index][0][1])

#[planet: [[x], [y]] ] * len(planets)
#positions[index][0]

#position = [planet: [ [x0, x1], [y0, y1] ] ] * len(planets)
#x = position[index][0]
